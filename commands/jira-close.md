# /jira-close

Run this command after `/gsd:complete-milestone` to close the milestone in Jira: release the Fix Version and archive the manifest.

## Usage

```
/jira-close
```

## What it does

1. Verifies that all Epics (Phases) are Done
2. Sets the Fix Version as **released** in Jira
3. Adds release notes to the Version
4. Archives the manifest to `.planning/jira-bridge/archive/`
5. Prepares a clean manifest for the next milestone

## Instructions for Claude

<instructions>

### Step 1 â€” Read config and manifest

Read `gsd-jira-bridge.json` and `.planning/jira-bridge/manifest.json`.
Extract `jira_version_id` from the `milestone` section.

### Step 2 â€” Verify Epic completion

Check in the manifest that all phases have `"status": "done"`.

If there are incomplete phases, show a warning and ask for confirmation before proceeding:
```
âš  Warning: the following Phases are not marked as complete in the manifest:
  - Phase 2: Dashboard (status: in_progress)

Proceed with milestone closure anyway? (y/n)
```

### Step 3 â€” Read GSD CHANGELOG or SUMMARY

Look for a `CHANGELOG.md` or `SUMMARY.md` in `.planning/` generated by `/gsd:complete-milestone`.
Extract key points to use as release notes.

If not found, use the list of completed Epics as release notes.

### Step 4 â€” Release the Fix Version in Jira

Use the Jira MCP to update the Version with `jira_version_id`:
- `released`: true
- `releaseDate`: today's date (ISO format: YYYY-MM-DD)
- `description`: release notes from CHANGELOG/SUMMARY

### Step 5 â€” Add release comment to Epics

For each Epic in the manifest, add a comment:
```
ðŸš€ Milestone complete â€” version [version_name] released
GSD archive: .planning/milestones/[milestone_folder]
```

### Step 6 â€” Archive the manifest

1. Create `.planning/jira-bridge/archive/` if it does not exist
2. Copy the current manifest to:
   `.planning/jira-bridge/archive/manifest-[version_name]-[timestamp].json`
3. Update the current manifest with the final state:
   ```json
   {
     "closed": true,
     "closed_at": "<ISO timestamp>",
     "archived_as": "manifest-[version_name]-[timestamp].json"
   }
   ```

### Step 7 â€” Prepare for next milestone

Write a fresh `.planning/jira-bridge/manifest.json` ready for the next milestone:
```json
{
  "version": "1.0.0",
  "synced_at": null,
  "milestone": {},
  "phases": [],
  "waves": [],
  "tasks": [],
  "unplanned": []
}
```

### Step 8 â€” Output summary

```
âœ“ Milestone closed in Jira

  Version   â†’ [name] â†’ Released âœ“
  Released  â†’ [date]
  Epics done â†’ X/X complete

  Manifest archived at:
  .planning/jira-bridge/archive/manifest-[name]-[timestamp].json

  Next step: /gsd:new-milestone â†’ then /jira-init
```

</instructions>
